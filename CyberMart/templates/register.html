{% extends "base.html" %}

{% block title %}Register - ShopCart{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h3 class="text-center">Create Account</h3>
            </div>
            <div class="card-body">
                <!-- VULNERABLE: No CSRF protection -->
                <form method="POST">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" name="username" required>
                        <small class="form-text text-muted">Username must be at least 3 characters long</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" name="password" required>
                        <small class="form-text text-muted">Password must be at least 6 characters long</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Confirm Password</label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                    </div>
                    
                    <!-- Hidden field for payment_info (empty for registration) -->
                    <input type="hidden" id="payment_info" name="payment_info" value="">
                    
                    <!-- VULNERABLE: No terms and conditions validation -->
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="terms" name="terms" required>
                        <label class="form-check-label" for="terms">
                            I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms and Conditions</a>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">Create Account</button>
                </form>
                
                <div class="mt-3 text-center">
                    <p>Already have an account? <a href="{{ url_for('login') }}">Login here</a></p>
                    <p class="text-muted small">ðŸ’¡ Tip: Use the "Fill Demo Data" button below to avoid duplicate registration errors</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms and Conditions Modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Terms and Conditions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>ShopCart Terms of Service</h6>
                <p>Welcome to ShopCart. Please read these terms carefully before using our service.</p>
                
                <h6>Data Collection</h6>
                <p>We collect and store the following information:</p>
                <ul>
                    <li>Username and email address</li>
                    <li>Purchase history</li>
                    <li>IP address and browser information for security</li>
                </ul>
                
                <h6>Privacy & Security</h6>
                <p>We are committed to protecting your privacy and securing your data. All information is handled according to our privacy policy.</p>
                
                <h6>Liability</h6>
                <p>ShopCart provides this service as-is. We are not responsible for any issues arising from the use of our platform.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- VULNERABLE: Client-side validation that can be bypassed -->
<script>
    document.querySelector('form').addEventListener('submit', function(e) {
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        
        // VULNERABLE: Client-side validation can be bypassed
        if (username.length < 3) {
            alert('Username must be at least 3 characters long');
            e.preventDefault();
            return false;
        }
        
        if (password.length < 6) {
            alert('Password must be at least 6 characters long');
            e.preventDefault();
            return false;
        }
        
        if (password !== confirmPassword) {
            alert('Passwords do not match');
            e.preventDefault();
            return false;
        }
        
        // VULNERABLE: Logging registration data to console
        console.log('Registration data:', {
            username: username,
            email: email
        });
    });
    
    // VULNERABLE: Auto-fill demo data
    function fillDemoData() {
        // Generate random username and email to avoid conflicts
        const randomId = Math.floor(Math.random() * 10000);
        document.getElementById('username').value = 'testuser' + randomId;
        document.getElementById('email').value = 'test' + randomId + '@rustybranch.io';
        document.getElementById('password').value = 'password123';
        document.getElementById('confirm_password').value = 'password123';
        document.getElementById('terms').checked = true;
    }
    
    // Check for suggested data from account_exists page
    function checkForSuggestedData() {
        const suggestedUsername = sessionStorage.getItem('suggestedUsername');
        const suggestedEmail = sessionStorage.getItem('suggestedEmail');
        
        if (suggestedUsername && suggestedEmail) {
            document.getElementById('username').value = suggestedUsername;
            document.getElementById('email').value = suggestedEmail;
            document.getElementById('password').value = 'password123';
            document.getElementById('confirm_password').value = 'password123';
            document.getElementById('terms').checked = true;
            
            // Clear the suggested data after using it
            sessionStorage.removeItem('suggestedUsername');
            sessionStorage.removeItem('suggestedEmail');
            
            // Show a message that data was auto-filled
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-info alert-dismissible fade show';
            alertDiv.innerHTML = `
                <i class="fas fa-info-circle me-2"></i>
                Suggested data has been auto-filled to avoid conflicts.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.card-body').insertBefore(alertDiv, document.querySelector('form'));
        }
    }
    
    // Run on page load
    document.addEventListener('DOMContentLoaded', checkForSuggestedData);
    
    // Add demo data button
    const demoButton = document.createElement('button');
    demoButton.type = 'button';
    demoButton.className = 'btn btn-outline-secondary mt-2';
    demoButton.textContent = 'Fill Demo Data';
    demoButton.onclick = fillDemoData;
    document.querySelector('form').appendChild(demoButton);
</script>
{% endblock %} 